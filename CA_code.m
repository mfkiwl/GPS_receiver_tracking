function ca_code = CA_code(PRN)
% Генерация C/A-кода GPS для указанного PRN (от 1 до 37)
% Вход: PRN - номер спутника (1-37)
% Выход: ca_code - вектор C/A-кода (1023 элемента, значения ±1)


% Инициализация регистров сдвига (G1 и G2) единицами
g1 = ones(1, 10); 
g2 = ones(1, 10);   

% Таблица отводов для G2 (по спецификации IS-GPS-200)
g2_taps = [
    2, 6;    % PRN 1
    3, 7;    % PRN 2
    4, 8;    % PRN 3
    5, 9;    % PRN 4
    1, 9;    % PRN 5
    2, 10;   % PRN 6
    1, 8;    % PRN 7
    2, 9;    % PRN 8
    3, 10;   % PRN 9
    2, 3;    % PRN 10
    3, 4;    % PRN 11
    5, 6;    % PRN 12
    6, 7;    % PRN 13
    7, 8;    % PRN 14
    8, 9;    % PRN 15
    9, 10;   % PRN 16
    1, 4;    % PRN 17
    2, 5;    % PRN 18
    3, 6;    % PRN 19
    4, 7;    % PRN 20
    5, 8;    % PRN 21
    6, 9;    % PRN 22
    1, 3;    % PRN 23
    4, 6;    % PRN 24
    5, 7;    % PRN 25
    6, 8;    % PRN 26
    7, 9;    % PRN 27
    8, 10;   % PRN 28
    1, 6;    % PRN 29
    2, 7;    % PRN 30
    3, 8;    % PRN 31
    4, 9;    % PRN 32
];

tap1 = g2_taps(PRN, 1);
tap2 = g2_taps(PRN, 2);
ca_code = zeros(1, 1023); 

% Генерация 1023 чипов кода
for i = 1:1023
    
    g2_out = mod(g2(tap1) + g2(tap2), 2);
    
    % C/A-код = XOR(G1, G2)
    ca_code(i) = 1 - 2*mod(g1(10) + g2_out, 2); % Преобразуем в ±1
    
    % Сдвигаем регистры
    g1 = [mod(g1(10) + g1(3), 2), g1(1:9)];
    g2 = [mod(g2(10) + g2(9) + g2(8) + g2(6) + g2(3) + g2(2), 2), g2(1:9)];
end
ca_code = -ca_code;

end
